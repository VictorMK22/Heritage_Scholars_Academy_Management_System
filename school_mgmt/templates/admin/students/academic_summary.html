{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
<link rel="stylesheet" href="{% static 'admin/css/forms.css' %}">
<style>
    .summary-container { display: flex; gap: 20px; margin-bottom: 30px; }
    .summary-card { flex: 1; background: #f8f9fa; padding: 15px; border-radius: 4px; }
    .summary-card h3 { margin-top: 0; color: #3498db; }
    .grade-table { margin-top: 20px; }
    .grade-avg { font-weight: bold; color: #2c3e50; }
</style>
{% endblock %}

{% block content %}
<h1>Academic Summary - {{ student.user.get_full_name }}</h1>

<div class="summary-container">
    <div class="summary-card">
        <h3>Student Information</h3>
        <p><strong>Class:</strong> {{ student.current_class }}</p>
        <p><strong>Admission Number:</strong> {{ student.admission_number }}</p>
        <p><strong>Guardian:</strong> {{ student.guardian.user.get_full_name }}</p>
    </div>
    
    <div class="summary-card">
        <h3>Performance Summary</h3>
        <p><strong>Total Assignments:</strong> {{ assignments.count }}</p>
        <p><strong>Submitted:</strong> {{ assignments|length }}</p>
        <p><strong>Average Grade:</strong> 
            <span class="grade-avg">
                {{ grades.avg_grade|default:"N/A" }}
            </span>
        </p>
    </div>
</div>

<div class="module">
    <h2>Grade Breakdown</h2>
    <table class="grade-table">
        <thead>
            <tr>
                <th>Subject</th>
                <th>Latest Grade</th>
                <th>Progress</th>
            </tr>
        </thead>
        <tbody>
            {% for subject in grades.subjects %}
            <tr>
                <td>{{ subject.name }}</td>
                <td>{{ subject.latest_grade|default:"-" }}</td>
                <td>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar" role="progressbar" 
                             style="width: {{ subject.progress }}%;" 
                             aria-valuenow="{{ subject.progress }}" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            {{ subject.progress }}%
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="module">
    <h2>Recent Assignments</h2>
    <table class="grade-table">
        <thead>
            <tr>
                <th>Assignment</th>
                <th>Due Date</th>
                <th>Status</th>
                <th>Grade</th>
            </tr>
        </thead>
        <tbody>
            {% for assignment in assignments|slice:":5" %}
            <tr>
                <td>{{ assignment.assignment.title }}</td>
                <td>{{ assignment.assignment.due_date|date:"M j, Y" }}</td>
                <td>
                    <span class="badge {% if assignment.status == 'Submitted' %}bg-success{% else %}bg-warning{% endif %}">
                        {{ assignment.get_status_display }}
                    </span>
                </td>
                <td>{{ assignment.grade|default:"-" }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4">No assignments found</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}